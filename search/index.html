<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search | Empire Rewritten</title>
  <meta name="description" content="Search the Empire Rewritten hub for books, world, library, and press.">
  <meta property="og:title" content="Search Empire Rewritten">
  <meta property="og:description" content="Find pages and media across the hub.">
  <meta property="og:image" content="../assets/img/og-default.webp">
  <link rel="stylesheet" href="../assets/css/site.css">
  <link rel="icon" href="../favicon.ico">
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="utility-links">
        <a href="../index.html#newsletter" class="nav-link">Join Newsletter</a>
      </div>
      <div class="brand">
        <div class="crest" aria-hidden="true">ER</div>
        <div class="brand-title">EMPIRE REWRITTEN</div>
        <div class="brand-sub">Official Codex</div>
      </div>
      <div class="utility-links">
        <a href="index.html" class="nav-link">Search</a>
        <a class="btn secondary" data-link="patreonUrl" href="#" aria-disabled="true">Patreon</a>
      </div>
    </div>
    <nav aria-label="Primary">
      <ul class="nav-links">
        <li><a href="../books/index.html">Books</a></li>
        <li><a href="../world/index.html">World</a></li>
        <li><a href="../news/index.html">News</a></li>
        <li><a href="../about/index.html">About</a></li>
        <li><a href="../library/index.html">Library</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="section">
      <h1>Search the Hub</h1>
      <p>Type to filter key pages and library items.</p>
      <input class="search-box" type="search" id="site-search" placeholder="Search books, world, library..." aria-label="Search the site">
    </section>

    <section class="section">
      <div id="search-results" class="search-results"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div>
        <h4>Books</h4>
        <ul>
          <li><a data-link="patreonBook1Url" href="#" aria-disabled="true">Book 1</a></li>
          <li><a data-link="patreonBook2Url" href="#" aria-disabled="true">Book 2</a></li>
        </ul>
      </div>
      <div>
        <h4>World</h4>
        <ul>
          <li><a href="../world/characters/index.html">Characters</a></li>
          <li><a href="../world/timeline/index.html">Timeline</a></li>
          <li><a href="../world/maps/index.html">Maps</a></li>
          <li><a href="../library/index.html">Library</a></li>
        </ul>
      </div>
      <div>
        <h4>Connect</h4>
        <ul>
          <li><a href="../index.html#newsletter">Newsletter</a></li>
          <li><a data-link="patreonUrl" href="#" aria-disabled="true">Patreon</a></li>
          <li><a data-link="contactEmail" href="#" aria-disabled="true">Contact</a></li>
          <li><a data-link="socials.twitter" href="#" aria-disabled="true">Socials</a></li>
        </ul>
      </div>
    </div>
    <div class="legal-bar">
      <a href="../privacy/index.html">Privacy Policy</a> • © Empire Rewritten
    </div>
  </footer>

  <script src="../assets/js/site.js"></script>
  <script>
    const staticLinks = [
      { title: 'Home', url: '../index.html', category: 'Hub' },
      { title: 'Books', url: '../books/index.html', category: 'Books' },
      { title: 'World', url: '../world/index.html', category: 'World' },
      { title: 'Characters', url: '../world/characters/index.html', category: 'World' },
      { title: 'Timeline', url: '../world/timeline/index.html', category: 'World' },
      { title: 'Maps', url: '../world/maps/index.html', category: 'World' },
      { title: 'Library', url: '../library/index.html', category: 'Media' },
      { title: 'Patreon', url: '../patreon/index.html', category: 'Support' },
      { title: 'Press Kit', url: '../press/index.html', category: 'Press' }
    ];

    const resultsEl = document.getElementById('search-results');
    const input = document.getElementById('site-search');
    let libraryItems = [];

    function render(query = '') {
      resultsEl.innerHTML = '';
      const q = query.toLowerCase();
      const merged = [...staticLinks, ...libraryItems];
      merged
        .filter(item => item.title.toLowerCase().includes(q) || item.category.toLowerCase().includes(q))
        .forEach(item => {
          const link = document.createElement('a');
          link.href = item.url;
          link.className = 'card';
          link.textContent = `${item.title} — ${item.category}`;
          resultsEl.appendChild(link);
        });
      if (!resultsEl.children.length) {
        const empty = document.createElement('div');
        empty.textContent = 'No results yet.';
        resultsEl.appendChild(empty);
      }
    }

    async function loadLibrary() {
      try {
        const res = await fetch('../assets/data/library.json');
        const data = await res.json();
        libraryItems = data.map(item => ({
          title: item.title,
          url: '../library/index.html',
          category: `Library • ${item.category}`
        }));
      } catch (e) {
        libraryItems = [];
      }
      render(input.value);
    }

    input.addEventListener('input', () => render(input.value));
    render('');
    loadLibrary();
  </script>
</body>
</html>
